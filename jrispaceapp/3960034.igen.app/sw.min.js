"use strict";function isMain(n,t){return(n.request.mode==="navigate"||n.request.method==="GET")&&checkPaths(t.toLowerCase())?!0:!1}function isAllowed(n){return serviceAllowedUrl(n)&&!forbiddenPaths.find(t=>n.toLowerCase().includes(t))?!0:!1}function serviceAllowedUrl(n){return n.indexOf(".igenapps.com")>-1||n.indexOf(".igen.app")>-1||n.indexOf("igwebapptest.azurewebsites.net")>-1?!0:!1}function checkPaths(n){let t=!1;return t=whiteList.find(t=>n.startsWith(t)),t?forbiddenPaths.find(t=>n.includes(t))?!1:!0:n.includes("cloudapp.net/")?!0:!1}const CACHE_VERSION_STATIC=23,CACHE_VERSION_SERVER=50,CACHE_VERSION_CONTENT=52;let CURRENT_CACHES={offline_static:"offline-static-v"+CACHE_VERSION_STATIC,offline_server:"offline-server-v"+CACHE_VERSION_SERVER,offline_appcontent:"offline-appcontent-v"+CACHE_VERSION_CONTENT};self.addEventListener("activate",n=>{n.waitUntil(self.clients.claim());let t=Object.keys(CURRENT_CACHES).map(function(n){return CURRENT_CACHES[n]});n.waitUntil(caches.keys().then(n=>Promise.all(n.map(n=>{if(t.indexOf(n)===-1&&!n.startsWith("offline-appid-"))return console.log("Deleting out of date cache:",n),caches.delete(n)}))))});self.addEventListener("install",n=>{console.log("Installing static cache"),n.waitUntil(caches.open(CURRENT_CACHES.offline_static).then(n=>(console.log(CURRENT_CACHES.offline_static),console.log(n),n.addAll(["https://igappfiles.azureedge.net/public/static/jquery-1.12.4.min.js","https://igappfiles.azureedge.net/public/static/kendo.mobile.min.js","https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js"]).then(()=>self.skipWaiting()))))});console.log("add message receiver");self.addEventListener("message",n=>{try{console.log("Got message");console.log(n.data);let f=n.data,i=0,t,r,u,e=!1;caches.open(CURRENT_CACHES.offline_server).then(o=>{f.map(function(n){console.log("cache "+n);i===0?n==="delete"?e=!0:t=n:i===1?(r=n,caches.open(CURRENT_CACHES.offline_appcontent).then(function(n){fetch(new Request("/app/getappversion?appid="+t),{mode:"no-cors"}).then(function(i){i.status===200&&n.put("/app/getappversion?appid="+t,i)})}),console.log("app version cached")):i===2?(u=n,caches.open("offline-appid-"+t+"s-"+CACHE_VERSION_SERVER+"-v"+r).then(function(n){fetch(new Request(u,{mode:"no-cors"})).then(function(t){t.status===200&&n.put(u,t);console.log("app url cached")})})):fetch(new Request(n,{mode:"no-cors"})).then(function(t){t.status===200&&o.put(n,t)});i++});console.log(f);let s="offline-appid-"+t+"s-"+CACHE_VERSION_SERVER+"-v"+r,h=Object.keys(CURRENT_CACHES).map(function(n){return CURRENT_CACHES[n]});e===!0?caches.keys().then(n=>Promise.all(n.map(n=>caches.delete(n)))):caches.keys().then(n=>Promise.all(n.map(n=>{if(n.startsWith("offline-appid-"+t+"s-")&&n!==s)return console.log("Deleting out of date cache:",n),caches.delete(n)})));n.ports[0].postMessage({error:null})})}catch(t){console.log("sw message err:"+t)}});console.log("added message receiver");try{console.log("add fetch");self.addEventListener("fetch",n=>{let t=n.request.url;if((isMain(n,t)||isAllowed(t))&&n.request.method==="GET")if(n.request.type!=="opaqueredirect"){let r=t.split("?")[0],i=0;if(r.toLowerCase().startsWith("https://app.igenapps.com")||r.startsWith("https://igwebapptest.azurewebsites.net"))i=r.split("/")[3].replace(/^\D+/g,""),i.indexOf("#")>-1&&(i=i.split("#")[0]),i>0&&console.log("app id in parameter "+i);else if(r.toLowerCase().indexOf(".igenapps.com")>-1||r.toLowerCase().indexOf(".igen.app")>-1){console.log("checking app id");let n=r.split("//")[1].split(".")[0];n>0&&(i=n,console.log("app id in domain "+i))}n.request.redirect==="manual"&&i>0?(console.log("main request"),n.respondWith(fetch("/app/getappversion?appid="+i).then(function(r){var u=r.clone();return r.json().then(function(f){let o=f,e="offline-appid-"+i+"s-"+CACHE_VERSION_SERVER+"-v"+o;return console.log("updated cache"+e),caches.open(CURRENT_CACHES.offline_appcontent).then(function(n){r.status===200&&n.put("/app/getappversion?appid="+i,u)}),caches.open(e).then(function(r){return console.log("open cache"),r.match(n.request.url).then(function(u){return u||fetch(n.request).then(function(u){return u.status===200&&r.put(n.request.url,u.clone()),console.log(t+" added"),caches.keys().then(n=>Promise.all(n.map(n=>{if(n.startsWith("offline-appid-"+i+"s-")&&n!==e)return console.log("Deleting out of date cache:",n),caches.delete(n)}))),u})})})})}).catch(function(t){return console.log(t),caches.open(CURRENT_CACHES.offline_appcontent).then(function(t){return t.match("/app/getappversion?appid="+i).then(function(t){return t.json().then(function(t){let r=t,u="offline-appid-"+i+"s-"+CACHE_VERSION_SERVER+"-v"+r;return caches.open(u).then(function(t){return console.log("open cache"),t.match(n.request.url).then(function(n){return n})})})})})}))):n.respondWith(caches.open(CURRENT_CACHES.offline_static).then(function(i){return i.match(n.request).then(function(i){return i||caches.open(CURRENT_CACHES.offline_server).then(function(i){return i.match(n.request).then(function(i){return i||caches.open(CURRENT_CACHES.offline_appcontent).then(function(i){return i.match(n.request).then(function(r){return r||fetch(n.request).then(function(r){return r.status===200&&i.put(n.request,r.clone()),console.log("cached "+t),r})})})})})})}))}else console.log("unhandled redirect for:"+t+" method "+n.request.method);else console.log("unhandled fetch for:"+t+" method "+n.request.method)});console.log("fetch added")}catch(error){console.log("Fetch :^(",error)}let whiteList=["https://igenwebapps.azureedge.net","https://igenapps.azureedge.net","https://app.igenapps.com","https://igwebapptest.azurewebsites.net","https://igserviceaka.azureedge.net","https://igstatic.azureedge.net","https://igtemplate.blob.core.windows.net","https://igtemplate.azureedge.net","https://igappfiles.azureedge.net","https://igappblobs.azureedge.net","https://ajax.googleapis.com","https://maps.googleapis.com","https://igenytfeed.azurewebsites.net"],forbiddenPaths=["/screenaccess/","/log/","/feed/","/socialnetwork","/manifest","/native","/error","/rss","/appcommunity","/pc","/app/native","/app/getappversion","/app/checkmemberaccess","/app/verifyaccess","/app/un","/app/off","/secure","/sw.min.js","/clearcache.html","/account"];